<!DOCTYPE html>
<html>

<head>
  <title>canvas模拟复摆</title>
  <style>
    html,
    body {
      height: 100%;
      background: #eee;
    }

    canvas {
      background: #fff;
      display: block;
      margin: 0 auto;
    }
  </style>
</head>

<body>
  <canvas id="canvas" width="800" height="600"></canvas>
  <script>
    var canvas = document.getElementById('canvas');
    var running = true;
    var raf = undefined;
    var CXS = 800;
    var CYS = 600;
    var v0 = 10;
    var angList = [0.1, 0.0999510857556216, 0.09980439039643417, 0.09956005696231988, 0.09921832366039936, 0.09877952375032478, 0.0982440850609254, 0.09761252980306127, 0.09688547386839612, 0.09606362632357533, 0.0951477888457189, 0.09413885467162264, 0.09303780820301505, 0.09184572349903773, 0.09056376387660567, 0.08919318019446151, 0.08773531017323351, 0.08619157625997526, 0.0845634853763218, 0.08285262789950805, 0.08106067522452433, 0.07918937583532745, 0.077240557784391, 0.07521612612038028, 0.0731180584818957, 0.07094840411383385, 0.06870928417201506, 0.06640288862250121, 0.06403147108676163, 0.06159735018132317, 0.059102907270408185, 0.056550582741032925, 0.05394287214132516, 0.051282327202541514, 0.048571552435585794, 0.045813200313300995, 0.04300997016408916, 0.040164606704049165, 0.03727989651050856, 0.03435866322700188, 0.031403767544762255, 0.028418104071087247, 0.025404597348049604, 0.022366198524061562, 0.019305884356120524, 0.01622665357136881, 0.013131522851519629, 0.010023524435178626, 0.006905704007214898, 0.0037811170071912785, 0.0006528248765576214, -0.0024761069112474235, -0.005602612244860047, -0.00872362744766772, -0.011836093897581832, -0.014936961778344894, -0.01802319316643306, -0.02109176499492768, -0.024139670154857393, -0.027163922444364337, -0.03016155948949853, -0.033129645478043326, -0.03606527306106223, -0.03896556707436455, -0.04182768757877384, -0.044648832530200716, -0.04742623985431228, -0.05015719057449172, -0.05283901182222649, -0.05546907932859943, -0.05804481955185553, -0.060563712311211625, -0.06302329368903849, -0.06542115830502579, -0.06775496132144383, -0.07002242058885227, -0.0722213194795143, -0.07434950884727029, -0.0764049089834907, -0.07838551132642257, -0.08028938078086312, -0.08211465748321886, -0.0838595587221482, -0.08552238056592742, -0.08710149952897343, -0.0885953738831004, -0.09000254537189133, -0.09132164057491197, -0.092551372175645, -0.09369054022541612, -0.09473803330085181, -0.09569282947754902, -0.0965539973514039, -0.09732069695351037, -0.097992180499719, -0.09856779311300624, -0.09904697347500707, -0.0994292543203866, -0.09971426287131878, -0.09990172123090603, -0.09999144661754153, -0.09998335152656142, -0.09987744385796093, -0.09967382690215147, -0.09937269922173296, -0.09897435440004772, -0.0984791808640873, -0.09788766148714714, -0.09720037312791727, -0.09641798607216755, -0.09554126340941708, -0.0945710603033591, -0.09350832317785251, -0.09235408885072556, -0.09110948350886243, -0.08977572162785302, -0.0883541048111566, -0.08684602064358862, -0.08525294129456208, -0.08357642206600337, -0.08181809990988183, -0.07997969197747822, -0.07806299393900355, -0.07606987812998486, -0.07400229177790527, -0.07186225523530214, -0.06965186011744744, -0.0673732670015743, -0.06502870341024104, -0.0626204617585458, -0.060150897385648015, -0.05762242573813536, -0.055037520159892106, -0.052398709447956625, -0.049708575365476924, -0.04696975080865462, -0.04418491662408951, -0.041356798879343, -0.03848816635093117, -0.03558182780676581, -0.03264062925596246, -0.029667451161165707, -0.026665205582835805, -0.023636833320626303, -0.020585301014842995, -0.017513598216747115, -0.014424734409209836, -0.011321736051119104, -0.008207643575531394, -0.005085508365479509, -0.0019583897176755375, 0.0011706480685488123, 0.004298538673426371, 0.007422217025450158, 0.010538622243252636, 0.013644700676878832, 0.01673740891818648, 0.019813716627470543, 0.022870609751375916, 0.025905093472392095, 0.028914195146408368, 0.03189496724213042, 0.03484449019778295, 0.03775987530154232, 0.04063826759320379, 0.04347684864023248, 0.04627283930351885, 0.04902350247487436, 0.051726145827450526, 0.05437812435988849, 0.05697684300030326, 0.059519759141049865, 0.06200438510987827, 0.06442829069916334, 0.06678910547838275, 0.06908452101338422, 0.0713122931392655, 0.07347024411684878, 0.07555626479278674, 0.07756831685856096, 0.07950443446384972, 0.08136272620119914, 0.08314137692393668, 0.08483864947291458, 0.08645288660592215, 0.08798251239577154, 0.08942603362252428, 0.09078204126650713, 0.09204921182879888, 0.09322630871305583, 0.09431218365751867, 0.09530577729573976, 0.09620612033110545, 0.09701233444252483, 0.09772363308088235, 0.09833932239738916, 0.09885880233722723, 0.09928156636412017, 0.09960720221764918, 0.0998353923052377];
    var len = angList.length;
    console.log('len=', len);
    // 第一步： 先画一个带短横的天花板
    var ceiling = {
      l: -350,
      r: 350,
      h: 0,
      step: 25,
      ang: Math.PI / 4 * 5,
      color: 'black',
      draw: function (ctx) {
        ctx.save();
        ctx.fillStyle = this.color;
        ctx.font = "bolder 12px serif";
        ctx.fillText("连接点", 10, 15);
        // 画线
        ctx.beginPath();
        ctx.moveTo(this.l, this.h);
        ctx.lineTo(this.r, this.h);
        ctx.closePath();
        ctx.stroke();
        // 线头的点
        ctx.beginPath();
        ctx.arc(0, 0, 6, 0, Math.PI, false);
        ctx.fill();
        ctx.restore();

        // 短横线：每隔25像素画一条10像素的短横
        for (var i = this.l; i <= this.r; i += this.step) {
          ctx.save();
          ctx.translate(i, this.h);
          // coordinate.draw(ctx);
          // 将线旋转一定角度
          ctx.rotate(this.ang);
          // coordinate.draw(ctx);
          // ctx.font = "10px serif";
          // ctx.fillStyle = this.color;
          // ctx.fillText("" + i, 10, 10);
          ctx.beginPath();
          ctx.moveTo(0, 0);
          ctx.lineTo(0, 10);
          ctx.stroke();
          ctx.restore();
        }
      }
    };

    // 单摆
    var pendulum = {
      x: 0,
      y: 400,
      lh: 400,
      radius: 15,
      color: 'black',
      ts: 0,
      calAng: function () {
        // todo: 计算当前角度，需要根据单排角速度进行计算
        // 用python计算等差时间在一个周期的角度变化数值
        this.ang = angList[this.ts];
        this.ts = this.ts >= len - 1 ? 0 : this.ts + 1;
      },
      draw: function (ctx) {
        ctx.save();
        this.calAng();
        // 缩放弧度
        ctx.rotate(this.ang);
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.lineTo(this.x, this.y);
        ctx.stroke();
        ctx.moveTo(this.x, this.y);
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, true);
        ctx.closePath();
        ctx.fillStyle = this.color;
        ctx.fill();
        // coordinate.draw(ctx, this.x, this.y);
        ctx.restore();

        ctx.save();
        ctx.fillStyle = 'rgb(255,127,36)';
        ctx.fillText("弧度偏移量：" + this.ang, this.x + 20, this.y + 40);
        ctx.restore();
      }
    };

    var coordinate = {
      color: 'rgba(238,0,0,1)',
      xl: 66,
      yl: 66,
      al: 3,
      draw: function (ctx, x, y) {
        var x0 = x || 0;
        var y0 = y || 0;
        ctx.save();
        ctx.fillStyle = this.color;
        ctx.strokeStyle = this.color;
        ctx.translate(x0, y0);
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.lineTo(this.xl, 0);
        ctx.lineTo(this.xl - this.al, -this.al);
        ctx.moveTo(this.xl, 0);
        ctx.lineTo(this.xl - this.al, this.al);
        ctx.fillText('X', this.xl, this.al);
        ctx.moveTo(0, 0);
        ctx.lineTo(0, this.yl);
        ctx.lineTo(-this.al, this.yl - this.al);
        ctx.moveTo(0, this.yl);
        ctx.lineTo(this.al, this.yl - this.al);
        ctx.fillText('Y', this.al, this.yl);
        ctx.stroke();
        ctx.restore();
      }
    };

    function draw() {
      var ctx = canvas.getContext('2d');
      ctx.save();
      // 会影响深层的样式填充
      ctx.fillStyle = 'rgba(255,255,255,0.3)';
      ctx.fillRect(0, 0, CXS, CYS);
      // ctx.clearRect(0, 0, CXS, CYS);
      ctx.translate(CXS / 2, 100);
      coordinate.draw(ctx, 20, 20);
      // 画天花板
      ceiling.draw(ctx);
      // 运动的单摆
      pendulum.draw(ctx);
      ctx.restore();
      ctx.font = "18px serif";
      ctx.fillText("单摆运动模拟", 50, 50);
      raf = window.requestAnimationFrame(draw);
    }

    canvas.addEventListener('click', function (e) {
      console.log(e.pageX, '--', e.pageY);
      if (!running) {
        raf = window.requestAnimationFrame(draw);
        running = true;
      } else {
        window.cancelAnimationFrame(raf);
        running = false;
      }
    });

    canvas.addEventListener('selectstart', function (e) {
      console.log(e);
    });
    draw();
  </script>
</body>

</html>